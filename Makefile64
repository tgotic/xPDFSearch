#make
DEFS = -DWIN32 -D_WIN32  -D_WIN64 -DCONSOLE -DNDEBUG -D_WIN32_WINNT=0x0502 -DWINVER=0x0502 -DNTDDI_VERSION=0x05020000 -D_WIN32_IE=0x0800 -DWIN32_LEAN_AND_MEAN -DMINGW_HAS_SECURE_API -DSTRSAFE_NO_DEPRECATE -D__MINGW_USE_VC2005_COMPAT 
INCLUDE=-I./xpdf-4.04 -I./xpdf-4.04/fofi -I./xpdf-4.04/xpdf -I./xpdf-4.04/goo -I./xpdf-4.04/splash -I./xpdf-4.04 -I./common -I.
WARNINGS = -Wall -Wextra -Wno-format -Wno-missing-braces -Wno-unknown-pragmas -Wno-missing-field-initializers -Wno-unused-parameter -Wno-multichar
CFLAGS = $(DEFS) $(INCLUDE) -O2 -fno-strict-aliasing $(WARNINGS) -mms-bitfields -fms-extensions 
CXXFLAGS = $(CFLAGS) -fno-exceptions
CC = gcc -static -municode
CXX = g++ -std=c++17 -static -municode 
RM = rm -rf
EXEEXT = .wdx64
LINK = $(CXX) -mwindows -mdll
LDFLAGS = -Wl,--dynamicbase,--nxcompat,--high-entropy-va,--image-base=0x140000000,--major-os-version=5,--minor-os-version=2,--major-subsystem-version=5,--minor-subsystem-version=2 -flto=4 -fuse-linker-plugin -static-libgcc -static-libstdc++
LIBS = -lole32
VPATH= ./xpdf-4.04/fofi:./xpdf-4.04/goo:./xpdf-4.04/xpdf
SRCCXX = FoFiBase.cc FoFiEncodings.cc FoFiIdentifier.cc FoFiTrueType.cc FoFiType1.cc FoFiType1C.cc \
        gfile.cc GHash.cc GList.cc gmem.cc GString.cc \
        AcroForm.cc Annot.cc Array.cc BuiltinFont.cc BuiltinFontTables.cc Catalog.cc CharCodeToUnicode.cc CMap.cc \
        Decrypt.cc Dict.cc Error.cc FontEncodingTables.cc Function.cc Gfx.cc GfxFont.cc \
        GfxState.cc GlobalParams.cc JArithmeticDecoder.cc Lexer.cc Link.cc NameToCharCode.cc Object.cc \
        OptionalContent.cc OutputDev.cc Page.cc Parser.cc PDFDoc.cc PDFDocEncoding.cc PSTokenizer.cc \
        SecurityHandler.cc Stream.cc TextOutputDev.cc TextString.cc UnicodeMap.cc UnicodeRemapping.cc UnicodeTypeTable.cc \
        UTF8.cc XRef.cc XFAScanner.cc Zoox.cc \
        ThreadData.cc PDFExtractor.cc TcOutputDev.cc xPDFInfo.cc
SRCRES= xPDFSearch.rc

.SUFFIXES: .o .obj .c .cpp .cxx .cc .h .hh .hxx $(EXEEXT) .rc .res

all: xPDFSearch$(EXEEXT)

OBJSC = $(SRCC:.c=.o)
OBJSCXX = $(SRCCXX:.cc=.o)
OBJSRES = $(SRCRES:.rc=.res)

.rc.res:
	windres --codepage=65001 --output-format=coff --input-format=rc --input=$< --output=$@
	
.c.o:
	$(CC) $(CFLAGS) -c -o $@ $<

.cpp.o:
	$(CXX) $(CXXFLAGS) -c -o $@ $<

.cc.o:
	$(CXX) $(CXXFLAGS) -c -o $@ $<

xPDFSearch$(EXEEXT): $(OBJSC) $(OBJSCXX) $(OBJSRES)
	$(LINK) $(LDFLAGS) -o $@ $(OBJSC) $(OBJSCXX) $(OBJSRES) $(LIBS)

clean:
	-$(RM) *.obj
	-$(RM) *.o
	-$(RM) *.res
	-$(RM) xPDFSearch$(EXEEXT)
	
  
